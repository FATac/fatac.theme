<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="plone">
    <body>
        <metal:block fill-slot="top_slot" tal:define="dummy python:request.set('disable_border',1)">
        </metal:block>
        <metal:main fill-slot="main" i18n:domain="fatac.theme">

            <div class="ac_breadcrump div_dotted_line_bottom TerminalDosis600">
                <span i18n:translate="Explorar">Explorar</span>
            </div>

            <div class="div_dotted_line_bottom arial12c666666">
                <a href="" class="arial15c666666 explorar_classe selected" rel="class:Person" data-conf="Agents" i18n:translate="agentes">Agents</a> |
                <a href="" class="arial15c666666 explorar_classe" rel="class:FrameActivity" data-conf="Events" i18n:translate="eventos">Esdeveniments</a> |
                <a href="" class="arial15c666666 explorar_classe" data-conf="Explora" rel="ObjectType:Collection" i18n:translate="colection">Col·lecció</a>
            </div>

            <script type="text/javascript">
                $(document).ready(function() {
                    querys = [ ["class:Person"], ['Year:[1984 TO '+new Date().getFullYear() + '],class:FrameActivity'], ["ObjectType:Collection"]];
                    $(".explorar_classe").each(function (i, item){ 
                        $(item).attr('rel', querys[i]);
                    });
                    $('#zona_resultats').html('<\img class="spinner_zona_resultats" src="spinner.gif" \/>');

                    querystring = {rows: 999999, s: '', conf: 'Agents', f: querys[0]};

                    parametres_visualitzacio = {querystring: querystring, visualitzacio: 'columnes', zoom: '1', pagina_actual: 1, resultats_per_pagina: 15};

                    //('#visual-portal-wrapper').get(0) = objecte dom sense envolcall jquery
                    $('#visual-portal-wrapper').get(0).parametres_visualitzacio = parametres_visualitzacio;

                    parametres_visualitzacio_json = JSON.stringify(parametres_visualitzacio);

                    $.post('resultatsView', {parametres_visualitzacio: parametres_visualitzacio_json}, function(data){
                        $('div#zona_resultats').replaceWith(data);
                        $('div#controls_resultats').css('display','none')
                        $('div#ordre_y_tipus_cerca').css('display','none')
                        $('#resultats_cerca').removeClass();
                    });
                });

                $('.explorar_classe').click(function(event) {

                    event.preventDefault();
                    event.stopImmediatePropagation();
                    event.stopPropagation();

                    $('.explorar_classe.selected').removeClass('selected');
                    $(this).addClass('selected');

                    $('#zona_resultats').html('<\img class="spinner_zona_resultats" src="spinner.gif" \/>');

                    querystring = {rows: 999999, s: '', conf: $(this).attr('data-conf'), f: [$(this).attr('rel')]};
                    visualitzacio = 'fitxa_cerca';
                    if ( $(this).attr('rel') != 'ObjectType:Collection'){
                        visualitzacio = 'columnes';
                    }
                    parametres_visualitzacio = {querystring: querystring, visualitzacio: visualitzacio, zoom: '1', pagina_actual: 1, resultats_per_pagina: 15};

                    //('#visual-portal-wrapper').get(0) = objecte dom sense envolcall jquery
                    $('#visual-portal-wrapper').get(0).parametres_visualitzacio = parametres_visualitzacio;

                    parametres_visualitzacio_json = JSON.stringify(parametres_visualitzacio);

                    $.post('resultatsView', {parametres_visualitzacio: parametres_visualitzacio_json}, function(data){
                        $('div#zona_resultats').replaceWith(data);
                        if (visualitzacio == 'columnes') {
                            $('div#controls_resultats').css('display','none')
                        }
                        $('div#ordre_y_tipus_cerca').css('display','none')
                        $('#resultats_cerca').removeClass();
                    });

                });
            </script>

            <div id="zona_resultats">
                <!-- -->
            </div>

        </metal:main>
    </body>
</html>
