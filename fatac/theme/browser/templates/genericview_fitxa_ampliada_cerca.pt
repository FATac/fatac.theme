<!--
crida demo1: http://localhost:8084/fatac/genericView?idobjecte=Angela_RicciLucchi&visualitzacio=fitxa_ampliada_cerca
crida demo2: tb es pot cridar amb parametres_visualitzacio
-->

<!-- TODO: acabar aquesta vista i adaptar-la al disseny (el que pinta ara no és correcte!) -->
<script type="text/javascript">
    $(document).ready(function() {
        crea_scrolls_verticals();
    });
</script>
<tal:rep tal:repeat="dades_objecte view/dades_genericview_all_sections">
    <div tal:condition="dades_objecte" tal:attributes="id string:div${dades_objecte/id}" class="fitxa_ampliada_cerca">

        <div class="row" tal:define="seccions dades_objecte/dades_seccions">

            <!-- Columna esquerra (Títol i Descripció) -->
            <div class="span5">
                <div class="slider_vertical" tal:attributes="id string:slideFitxaOpcionsId-${dades_objecte/id}">
                    <div class="div_interior">
                        <tal:rep tal:repeat="seccio seccions">
                            <tal:cond tal:condition="python: seccio['nom'] in ['header', 'body']">
                                <tal:rep tal:repeat="dada seccio/dades">

                                    <!-- Titol + Icona Tipus objecte -->
                                    <tal:header tal:condition="python: repeat['dada'].index == 0 and seccio['nom'] == 'header'">
                                        <!-- Enllaç a objecte -->
                                        <a href="#" tal:attributes="href string:${context/portal_url}/genericView?idobjecte=${dades_objecte/id}">
                                            <div class="georgia20c333333Ital caixa_titol">
                                                <span metal:use-macro="context/macro_dades/macros/dadaObjecte">x</span>
                                                <img class="miniatura_classe"
                                                     tal:attributes="src dades_objecte/thumbnail_classe; alt dades_objecte/titol; id dades_objecte/id" />
                                            </div>
                                        </a>
                                        <tal:co tal:define="isanon context/@@plone_portal_state/anonymous"
                                                tal:condition="not: isanon">
                                            <img class="addPlaylist" tal:attributes="rel dades_objecte/id" src="++resource++fatac.content/images/add_playlist.png" />
                                        </tal:co>
                                    </tal:header>

                                    <!-- Text del cos -->
                                    <tal:body tal:condition="python: seccio['nom'] == 'body'">
                                        <div class="georgia13c333333">
                                           <span metal:use-macro="context/macro_dades/macros/dadaObjecte">x</span><br/>
                                        </div>
                                    </tal:body>

                                </tal:rep>
                            </tal:cond>
                        </tal:rep>
                    </div>
                </div>
            </div>

            <!-- Columna dreta (Contingut) -->
            <div class="span10">
                <tal:rep tal:repeat="seccio seccions">
                    <tal:def tal:condition="python: seccio['nom'] not in ['header', 'body']"
                             tal:define="slider_vertical python: dades_objecte['te_subcerca'] == 'amb_subcerca' and (seccio['nom'] == 'header' or seccio['nom'] == 'body');
                                        start repeat/seccio/start; end repeat/seccio/end; es_div_content python: seccio['nom'] == 'content';
                                        hi_ha_content dades_objecte/hi_ha_seccio_content">

                        <!-- estructura: si és el primer div i no és el div content obrim div columna esquerra -->
                        <tal:repl tal:condition="python: hi_ha_content and start and es_div_content==False" tal:replace="structure string:<div class='divs_esq'>" />
                        <!-- estructura: si no és el primer div i és el div content, o és l'últim div, tanquem columna esquerra -->
                        <tal:repl tal:condition="python: (hi_ha_content and start==False and es_div_content)" tal:replace="structure string:</div>" />

                        <div tal:attributes="id string:${seccio/nom}_objecte; class python:slider_vertical and 'slider_vertical seccio_dades' or 'seccio_dades'" tal:condition="seccio/dades">
                            <!-- estructura: si hi ha subcerca, header y body tenen slider vertcal; l'obrim -->
                            <tal:repl tal:condition="slider_vertical" tal:replace="structure string:<div class='div_interior'>" />

                            <tal:rep tal:repeat="dada seccio/dades">

                                <!-- Fiquem tot el que no sigui de la capçalera, el cos i la cerca -->
                                <tal:co tal:condition="python: dada['tipus'] not in ['header', 'body', 'search', 'objects']">
                                    <span metal:use-macro="context/macro_dades/macros/dadaObjecte">x</span><br/>
                                </tal:co>

                            </tal:rep>

                            <!-- estructura: si hi ha subcerca, header y body tenen slider vertcal; el tanquem -->
                            <tal:repl tal:condition="slider_vertical" tal:replace="structure string:</div>" />
                        </div>

                    </tal:def>
                </tal:rep>
            </div>

        </div>
    </div>
</tal:rep>

<tal:co tal:define="isanon context/@@plone_portal_state/anonymous"
        tal:condition="not: isanon">
    <script type="text/javascript">
        addPlaylistMenu();
    </script>
</tal:co>
