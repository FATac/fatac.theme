<tal:comment tal:replace="nothing">
crida demo1: http://localhost:8084/fatac/genericView?idobjecte=Angela_RicciLucchi&visualitzacio=fitxa_ampliada_cerca_overlay
crida demo2: tb es pot cridar amb parametres_visualitzacio
</tal:comment>

<tal:rep tal:repeat="dades_objecte view/dades_genericview_all_sections">
    <div class="fitxa_ampliada_cerca_overlay" tal:condition="dades_objecte" tal:attributes="id string:div${dades_objecte/id}">
        <tal:comment tal:replace="nothing">Preview de l'Slide</tal:comment>
        <div class="slide-preview">
            <div class="thumbnail">
                <img tal:attributes="src dades_objecte/thumbnail_objecte; alt dades_objecte/titol"/>
            </div>
            <div class="dades">
                <img tal:attributes="src string:${dades_objecte/thumbnail_classe}_neg.png;
                                                                        alt dades_objecte/titol;
                                                                        id dades_objecte/id" />
                <p tal:content="dades_objecte/titol"/>
            </div>
        </div>
        <tal:def tal:define="seccions dades_objecte/dades_seccions">

            <tal:comment tal:replace="nothing">(Títol i Descripció)</tal:comment>
            <div class="fs-info">
                <div class="slider_vertical" tal:attributes="id string:slideFitxaOpcionsId-${dades_objecte/id}">
                    <div class="div_interior">
                        <tal:rep tal:repeat="seccio seccions">
                            <tal:cond tal:condition="python: seccio['nom'] in ['header', 'body']">
                                <tal:rep tal:repeat="dada seccio/dades">

                                    <tal:header tal:condition="python: repeat['dada'].index == 0 and seccio['nom'] == 'header'">
                                        <div class="header">
                                            <a href="#" tal:attributes="href string:${context/portal_url}/genericView?idobjecte=${dades_objecte/id}">
                                                <div>
                                                        <span metal:use-macro="context/macro_dades/macros/dadaObjecte">x</span>
                                                </div>
                                            </a>
                                        </div>
                                    </tal:header>

                                    <!-- Text del cos -->
                                    <tal:body tal:condition="python: seccio['nom'] == 'body'">
                                        <div class="body">
                                            <span metal:use-macro="context/macro_dades/macros/dadaObjecte">x</span>
                                        </div>
                                    </tal:body>

                                </tal:rep>
                            </tal:cond>
                        </tal:rep>
                    </div>
                </div>
            </div>

            <tal:comment tal:replace="nothing">(Contingut)</tal:comment>
            <div class="seccions">

                <tal:comment tal:replace="nothing">
                    Tot el codi de dins el tal:rep està copiat de fatac/content/dummy_templates/view.pt
                    - afegint dues condicions: que la secció no sigui no header ni body, i que el tipus no sigui search ni objects
                    - eliminant els botons per afegir a playlist i mostrar/amagar comentaris
                    TODO: perquè no pot ser de tipus objects? (lpmayos, 11.07.2012)
                </tal:comment>
                <tal:rep tal:repeat="seccio seccions">
                    <tal:def tal:condition="python: seccio['nom'] not in ['header', 'body']"
                             tal:define="te_subcerca python:dades_objecte['te_subcerca'] == 'amb_subcerca';
                                        slider_vertical python: dades_objecte['te_subcerca'] == 'amb_subcerca' and (seccio['nom'] == 'header' or seccio['nom'] == 'body');
                                        start repeat/seccio/start; end repeat/seccio/end; es_div_content python: seccio['nom'] == 'content';
                                        hi_ha_content dades_objecte/hi_ha_seccio_content;
                                        isanon context/@@plone_portal_state/anonymous;
                                        nom_seccio seccio/nom;
                                        hi_ha_dades_seccio python: len(seccio['dades']) > 0;
                                        num view/retNumComentaris;">

                        <tal:comment tal:replace="nothing">
                            estructura: si és el primer div i no és el div content obrim div columna esquerra
                        </tal:comment>
                        <tal:repl tal:condition="python: hi_ha_content and start and es_div_content==False" tal:replace="structure string:<div class='divs_esq'>" />

                        <tal:comment tal:replace="nothing">
                            estructura: si no és el primer div i és el div content, o és l'últim div, tanquem columna esquerra
                        </tal:comment>
                        <tal:repl tal:condition="python: (hi_ha_content and start==False and es_div_content)" tal:replace="structure string:</div>" />


                        <div tal:attributes="id string:${seccio/nom}_objecte; class python:(slider_vertical and 'slider_vertical seccio_dades ' or 'seccio_dades ')" tal:condition="seccio/dades">

                            <tal:comment tal:replace="nothing">
                                estructura: si hi ha subcerca, header y body tenen slider vertcal; l'obrim
                            </tal:comment>
                            <tal:repl tal:condition="slider_vertical" tal:replace="structure string:<div class='div_interior'>" />

                            <tal:rep tal:repeat="dada seccio/dades">
                                <tal:co tal:condition="python: dada['tipus'] not in ['header', 'body', 'search', 'objects']">
                                    <tal:def tal:define="start_dada repeat/dada/start"
                                             tal:condition="dada/valor">

                                        <b metal:use-macro="context/macro_dades/macros/dadaObjecte">x</b>

                                        <br/><br/>

                                    </tal:def>
                                </tal:co>
                            </tal:rep>

                            <tal:comment tal:replace="nothing">
                                estructura: si hi ha subcerca, header y body tenen slider vertcal; el tanquem
                            </tal:comment>
                            <tal:repl tal:condition="slider_vertical" tal:replace="structure string:</div>" />
                        </div>

                    </tal:def>
                </tal:rep>


            </div>

        </tal:def>
    </div>
</tal:rep>