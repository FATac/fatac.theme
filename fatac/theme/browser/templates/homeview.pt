<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="fatac.theme">
    <body>
        <metal:block fill-slot="top_slot" tal:define="dummy python:request.set('disable_border',1)">
        </metal:block>
        <metal:content-title fill-slot="content-title"></metal:content-title>
        <metal:content-description fill-slot="content-description"></metal:content-description>
        <metal:content-core fill-slot="content-core">
            <metal:main-macro define-macro="content">

                    <!-- TODO: correcte posar aquest js aquí? Hi ha un lloc millor? -->
                    <script type="text/javascript">
                        $(document).ready(function() {

                            //TODO: unificar el codi dels dos scrollers (no fet per falta de temps)

                            var sort = 'creation+desc';
                            querystring = {start: 0, rows: 15, sort: sort, conf: 'Explorar'};
                            parametres_visualitzacio = {querystring: querystring, visualitzacio: 'fitxa_home', pagina_actual: 1, resultats_per_pagina: 15};
                            $('#visual-portal-wrapper').get(0).parametres_visualitzacio = parametres_visualitzacio;
                            parametres_visualitzacio_json = JSON.stringify(parametres_visualitzacio);
                            $.post('displayResultatsPaginaView', {parametres_visualitzacio: parametres_visualitzacio_json}, function(data){
                                $('.items_ultims_documents').replaceWith(data);

                                //envolcallem cada 5 elements en un div, xq funcioni l'scrollable
                                var fila_actual = 1;
                                var nova_fila = 1;
                                $('.scrollable_ultims_documents .genericview_fitxa_home').each(function(i) {
                                    nova_fila = (parseInt(i/5) + 1);
                                    if (nova_fila !== fila_actual) {
                                        $('.scrollable_ultims_documents .fila' + fila_actual).wrapAll( '<div class="fila fila' + fila_actual + '" />' );
                                        fila_actual = nova_fila;
                                    }
                                    $(this).addClass('fila' + nova_fila);
                                });
                                $('.scrollable_ultims_documents .fila' + fila_actual).wrapAll( '<div class="fila fila' + fila_actual + '" />' );
                                if (fila_actual === 1) { $('.arrow_up').addClass("hidden"); $('.arrow_down').addClass("hidden"); }

                                $(".scrollable_ultims_documents").scrollable({api:true, vertical: true, mousewheel: true});

                            });

                            var sort = 'lastView+desc';
                            querystring = {start: 0, rows: 15, sort: sort, conf: 'Explorar'};
                            parametres_visualitzacio = {querystring: querystring, visualitzacio: 'fitxa_home', pagina_actual: 1, resultats_per_pagina: 15};
                            $('#visual-portal-wrapper').get(0).parametres_visualitzacio = parametres_visualitzacio;
                            parametres_visualitzacio_json = JSON.stringify(parametres_visualitzacio);
                            $.post('displayResultatsPaginaView', {parametres_visualitzacio: parametres_visualitzacio_json}, function(data){
                                $('.items_ultims_consultats').replaceWith(data);

                                //envolcallem cada 5 elements en un div, xq funcioni l'scrollable
                                var fila_actual = 1;
                                var nova_fila = 1;
                                $('.scrollable_ultims_consultats .genericview_fitxa_home').each(function(i) {
                                    nova_fila = (parseInt(i/5) + 1);
                                    if (nova_fila !== fila_actual) {
                                        $('.scrollable_ultims_consultats .fila' + fila_actual).wrapAll( '<div class="fila fila' + fila_actual + '" />' );
                                        fila_actual = nova_fila;
                                    }
                                    $(this).addClass('fila' + nova_fila);
                                });
                                $('.scrollable_ultims_consultats .fila' + fila_actual).wrapAll( '<div class="fila fila' + fila_actual + '" />' );
                                if (fila_actual === 1) { $('.arrow_up').addClass("hidden"); $('.arrow_down').addClass("hidden"); }

                                $(".scrollable_ultims_consultats").scrollable({api:true, vertical: true, mousewheel: true});

                            });

                        });
                    </script>

                    <div id="text_intro" tal:define="text view/getFrontPage" tal:condition="text">
                        <div tal:replace="structure text">text introductori</div>
                    </div>

                    <div id="ultims_documents">

                        <!-- arrow_desplegable: cal que tingui la classe arrow_desplegable que indica que plega o desplega un div,
                            arrow_top o arrow_bottom que indica si plega o desplega, i una tercera classe que indica l'id del div
                            que plega o desplega, també indicat a rel -->
                        <div class="titol_home">
                            <img rel="ultims_docs" class="arrow_top ultims_docs" src="++resource++fatac.theme.images/ico_arrow_up.png" alt="Tanca" title="Tanca" i18n:attributes="title;alt"/>
                            <img rel="ultims_docs" class="arrow_bottom ultims_docs hidden" src="++resource++fatac.theme.images/ico_arrow_down.png" alt="Obre" title="Obre" i18n:attributes="title;alt"/>
                            <span class="georgia13c999999" i18n:translate="ultims_documents">Últims documents</span>
                        </div>

                        <div class="requadre_resultats" id="ultims_docs">
                            <a class="arrow_left prev browse left">
                                <img class="arrow_up" src="++resource++fatac.theme.images/arrow_up_search.png" alt="Següents" i18n:attributes="alt;" />
                            </a>
                            <div class="visualClear"><!--  --></div>

                            <div class="scrollable_ultims_documents scrollable_fatac">
                                <div class="items_ultims_documents items_fatac">
                                    <img class="spinner_home" src="spinner.gif" alt="Carregant..." i18n:attributes="alt;" />
                                </div>
                            </div>

                            <div class="visualClear"><!--  --></div>
                            <a class="arrow_right next browse right">
                                <img class="arrow_down" src="++resource++fatac.theme.images/arrow_down_search.png" alt="Anteriors" i18n:attributes="alt" />
                            </a>
                        </div>
                    </div>

                    <div id="ultims_consultats">

                        <div class="titol_home">
                            <img rel="ultims_cons" class="arrow_top ultims_cons" src="++resource++fatac.theme.images/ico_arrow_up.png" alt="Tanca" title="Tanca" i18n:attributes="title;alt"/>
                            <img rel="ultims_cons" class="arrow_bottom ultims_cons hidden" src="++resource++fatac.theme.images/ico_arrow_down.png" alt="Obre" title="Obre" i18n:attributes="title;alt"/>
                            <span class="georgia13c999999" i18n:translate="ultims_consultats">Últims consultats</span>
                        </div>

                        <div class="requadre_resultats" id="ultims_cons">
                            <a class="arrow_left prev browse left">
                                <img class="arrow_up" src="++resource++fatac.theme.images/arrow_up_search.png" alt="Següents" i18n:attributes="alt;" />
                            </a>
                            <div class="visualClear"><!--  --></div>

                            <div class="scrollable_ultims_consultats scrollable_fatac">
                                <div class="items_ultims_consultats items_fatac">
                                    <img class="spinner_home" src="spinner.gif" alt="Carregant..." i18n:attributes="alt;"/>
                                </div>
                            </div>

                            <div class="visualClear"><!--  --></div>
                            <a class="arrow_right next browse right">
                                <img class="arrow_down" src="++resource++fatac.theme.images/arrow_down_search.png" alt="Anteriors" i18n:attributes="alt" />
                            </a>
                        </div>
                    </div>

                    <script type="text/javascript">
                        inicialitza_arrows();
                    </script>

            </metal:main-macro>
        </metal:content-core>
    </body>
</html>